name: jd_check_in

on: 
  workflow_dispatch:
  schedule:
    - cron: "8 16 * * *"
jobs:
  start:
    runs-on: ubuntu-latest
    steps:
      - name: prepare
        uses: actions/checkout@v2
        
      - name: prepare node
        uses: actions/setup-node@v1
        with:
          node-version: 12

      - name: run job
        run: |
          npm install request
          wget -q -O - https://raw.githubusercontent.com/NobyDa/Script/master/JD-DailyBonus/JD_DailyBonus.js | node > jd.log
          if grep -q "京东签到" jd.log
          then
            echo 'success'
          else
            echo 'fail'
          fi
        id: jd
        #run: |
         # npm install request
         # wget -q -O - https://raw.githubusercontent.com/NobyDa/Script/master/JD-DailyBonus/JD_DailyBonus.js \ 
         # | cat \ 
         # | sed -e "s@var Key = ''@var Key = '${{ secrets.jd_key1 }}'@g" \ 
         # | sed -e "s@var Key = ''@var Key = '${{ secrets.jd_key2 }}'@g" \ 
         # | cat | node > jd.log
         # ls
        
      #- name: Send mail
      #  if: steps.jd.outputs.result != 'success'
      #  uses: dawidd6/action-send-mail@v2
      #  with:
      #    server_address: smtp.gmail.com
      #    server_port: 465
      #    username: ${{ secrets.MAIL_USERNAME }}
      #    password: ${{ secrets.MAIL_PASSWORD }}
      #    subject: JD Checkin Failed
      #    body: file://jd.log
      #    to: ${{ secrets.RECEIVER }}
      #    from: Nobody
      #    content_type: text/html
